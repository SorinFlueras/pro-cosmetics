jQuery(document).ready(function(a){"use strict";function f(a){return'<i class="fa fa-'+a.text+'"></i> '+a.text}function g(b){"undefined"!=typeof a.fn.select2&&a.each(b,function(){a(this).select2({width:"100%",formatResult:f})})}var b=a(".endpoints-container");"undefined"!=typeof a.fn.nestable&&b.nestable({expandBtnHTML:"",collapseBtnHTML:""}),a("form#plugin-fw-wc").on("submit",function(b){if("undefined"!=typeof a.fn.nestable){var c=a(".dd").nestable("serialize"),d=JSON.stringify(c);a("input.endpoints-order").val(d)}}),a(document).on("click",".open-options",function(){var b=a(this).closest(".endpoint");a(this).find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-up"),b.find(".endpoint-content").first().toggleClass("dd-nodrag"),b.find(".endpoint-options").first().slideToggle()}),a(document).on("click",".add_new_field",function(b){b.stopPropagation();var c=a(this),e=c.data("target"),f=c.html(),g=a(document).find(".new-field-form").clone();d(g,e,f),g.dialog("open")});var c=!1,d=function(b,c,d){b.dialog({title:d,modal:!0,width:500,resizable:!1,autoOpen:!1,buttons:[{text:"Save",click:function(){a(this).find(".loader").css("display","inline-block"),a(this).add_new_field_handler(c),a(document).one("yith_wcmap_field_added",function(){b.dialog("close")})}}],close:function(a,c){b.dialog("destroy"),b.remove()}})};a.fn.add_new_field_handler=function(d){var e=a(this),f=e.find("#yith-wcmap-new-field").val(),h=e.find(".error-msg");c&&c.abort(),c=a.ajax({url:ywcmap.ajaxurl,data:{target:d,field_name:f,action:ywcmap.action_add},dataType:"json",beforeSend:function(){},success:function(c){if(e.find(".loader").hide(),c.error||b.find('[data-id="'+c.field+'"]').length)return void h.html(c.error);var d=a(c.html);a(".endpoints-container > ol.endpoints > li.endpoint").last().after(d),g(d.find("select"));var f=d.find("textarea").attr("id"),i=tinyMCEPreInit.mceInit,j=Object.keys(i)[0],k=i[j],l=tinyMCEPreInit.qtInit,m=Object.keys(l)[0],n=i[m];k.selector=f,k.body_class=k.body_class.replace(j,f),n.id=f,tinymce.init(k),tinyMCE.execCommand("mceAddEditor",!1,f),quicktags(n),QTags._buttonsInit(),a(document).trigger("yith_wcmap_field_added")}})};var e=function(a,b){var g,h,c=b.closest(".endpoint"),d=c.find(".hide-show-check"),e="checkbox"==a?b:d.first(),f=c.find(".hide-show-trigger");h=!!(e.is(":checked")&&"checkbox"==a||!e.is(":checked")&&"link"==a),d.prop("checked",h),g=e.is(":checked")?ywcmap.hide_lbl:ywcmap.show_lbl,f.html(g)};a(document).on("change",".hide-show-check",function(){e("checkbox",a(this))}),a(document).on("click",".hide-show-trigger",function(){e("link",a(this))}),a(document).on("click",".remove-trigger",function(){var b=a(this),c=b.data("endpoint"),d=a("input.endpoint-to-remove");if("undefined"==typeof c||!d.length)return!1;var e=confirm(ywcmap.remove_alert);if(1!=e)return!1;var f=b.closest(".dd-item"),g=f.find("ol.endpoints"),h=d.val(),i=h.length?h.split(","):[];if(i.push(c),d.val(i.join(",")),g.length){var j=g.find("li.dd-item");f.after(j)}f.remove()}),g(b.find("select"))});